<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: util/getPoints.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: util/getPoints.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * getPoints - Returns an amount of points and updates various point-related data for players
 *
 * @param  {String} type The type of the question
 * @param  {Question} question The question
 * @param  {Number|String|Number[]} choice The choice of the player
 * @param  {Client} client The client
 * @param  {Object} answer The player's answer
 * @returns {Number} The points earned for the question
 */
module.exports = function getPoints(type, question, choice, client, answer) {
  const {pointsData} = answer,
    {answerStreakPoints} = pointsData,
    correct = answer.isCorrect;
  pointsData.lastGameBlockIndex = !client.currentQuestionIndex ? 0 : client.currentQuestionIndex - 1;
  answerStreakPoints.previousStreakBonus = answerStreakPoints.streakBonus;
  answerStreakPoints.previousStreakLevel = answerStreakPoints.streakLevel;
  switch(type) {
    case "word_cloud":
    case "multiple_select_poll":
    case "content":
    case "survey": {
      pointsData.questionPoints = 0;
      return 0;
    }
    case "multiple_select_quiz": {
      choice = Array.from(choice);
      if(correct &amp;&amp; answer.pointsQuestion) {
        const responseRatio = (answer.receivedTime -  this.questionStartTime) / (question.time || 20000),
          newValue = responseRatio / 2,
          inverse = 1 - newValue,
          maxPoints = 1000 * (question.pointsMultiplier || 1),
          points = Math.round(inverse * maxPoints * choice.length);
        let streakBonus = 0;
        if(client.options.enableStreakBonus) {
          streakBonus = answerStreakPoints.streakLevel >= 4 ? 500 : answerStreakPoints.streakLevel * 100;
        }
        pointsData.questionPoints = points;
        pointsData.totalPointsWithoutBonuses += points;
        pointsData.totalPointsWithBonuses += points + streakBonus;
        answerStreakPoints.streakLevel++;
        answerStreakPoints.totalStreakPoints += streakBonus;
        answerStreakPoints.streakBonus = streakBonus;
        return points + streakBonus;
      } else if (correct) {
        pointsData.questionPoints = 0;
        answerStreakPoints.streakLevel++;
        answerStreakPoints.streakBonus = 0;
      } else {
        pointsData.questionPoints = 0;
        answerStreakPoints.streakBonus = 0;
        answerStreakPoints.streakLevel = 0;
        return 0;
      }
      return;
    }
    default: {
      if(correct &amp;&amp; answer.pointsQuestion) {
        const responseRatio = (answer.receivedTime -  client.questionStartTime) / (question.time || 20000),
          newValue = responseRatio / 2,
          inverse = 1 - newValue,
          maxPoints = 1000 * (question.pointsMultiplier || 1),
          points = Math.round(inverse * maxPoints);
        let streakBonus = 0;
        if(client.options.enableStreakBonus) {
          streakBonus = answerStreakPoints.streakLevel >= 4 ? 500 : answerStreakPoints.streakLevel * 100;
        }
        pointsData.questionPoints = points;
        pointsData.totalPointsWithoutBonuses += points;
        pointsData.totalPointsWithBonuses += points + streakBonus;
        answerStreakPoints.streakLevel++;
        answerStreakPoints.totalStreakPoints += streakBonus;
        answerStreakPoints.streakBonus = streakBonus;
        return points + streakBonus;
      } else if(correct) {
        // correct, but not a points question
        pointsData.questionPoints = 0;
        answerStreakPoints.streakBonus = 0;
        return 0;
      } else {
        // wrong
        pointsData.questionPoints = 0;
        answerStreakPoints.streakBonus = 0;
        answerStreakPoints.streakLevel = 0;
        return 0;
      }
    }
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a></li><li><a href="CustomClient.html">CustomClient</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Fri Jan 22 2021 21:22:01 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
